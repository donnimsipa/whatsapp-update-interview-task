%%{init: {'theme': 'forest', 'logLevel': 'fatal', 'themeVariables': { 'primaryColor': '#1f2937', 'primaryBorderColor': '#10b981', 'primaryTextColor': '#ecfeff', 'lineColor': '#10b981', 'tertiaryColor': '#111827'}}}%%
flowchart TB
    subgraph Hosting
        VM[Docker/Kubernetes VM]
        n8n[n8n Server]
    end
    subgraph Scaling
        Split[Split In Batches]
        Parallel[Parallel HTTP Nodes]
    end
    subgraph Observability
        Logs[Execution Log]
        Metrics[Custom Metrics]
        Alerts[Slack/Email]
    end
    subgraph Rerun
        UI[Web UI Button]
        API[REST Trigger]
    end

    VM --> n8n
    n8n --> Split
    Split --> Parallel
    Parallel --> FHIR[FHIR API]
    n8n --> Logs
    Logs --> Metrics
    Metrics --> Alerts
    Alerts --> Ops[On-call]
    n8n --> UI
    UI --> RerunTarget[(targetDate input)]
    API --> RerunTarget
    RerunTarget --> n8n
